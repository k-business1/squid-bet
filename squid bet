version: '3.8'
services:
  backend:
    build: ./backend-spring
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=dev
    volumes:
      - ./backend-spring/uploads:/app/uploads
  node-server:
    build: ./realtime-server
    ports:
      - "3000:3000"
    depends_on:
      - backend
  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - node-server
      - backend
FROM eclipse-temurin:17-jdk-jammy
WORKDIR /app
COPY . /app
RUN ./mvnw -q -DskipTests package
EXPOSE 8080
CMD ["java","-jar","target/backend-spring-0.0.1-SNAPSHOT.jar"]
<project xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
  http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.squidbet</groupId>
  <artifactId>backend-spring</artifactId>
  <version>0.0.1-SNAPSHOT</version>
  <packaging>jar</packaging>
  <properties>
    <java.version>17</java.version>
    <spring.boot.version>3.1.4</spring.boot.version>
  </properties>
  <dependencies>
    <dependency>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-starter-web</artifactId>
      <version>${spring.boot.version}</version>
    </dependency>
    <dependency>
      <groupId>commons-fileupload</groupId>
      <artifactId>commons-fileupload</artifactId>
      <version>1.5</version>
    </dependency>
  </dependencies>
  <build>
    <plugins>
      <plugin>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-maven-plugin</artifactId>
        <version>${spring.boot.version}</version>
      </plugin>
    </plugins>
  </build>
</project>
package com.squidbet;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class BackendApplication {
    public static void main(String[] args) {
        SpringApplication.run(BackendApplication.class, args);
    }
}
package com.squidbet.model;

public class User {
    private Long id;
    private String phone;
    private String username;
    private String password; // NOTE: plaintext for demo only. Don't use in prod.
    private String role; // "ADMIN" or "USER"
    private long balance;

    public User() {}
    public User(Long id, String phone, String username, String password, String role, long balance) {
        this.id = id; this.phone = phone; this.username = username; this.password = password; this.role = role; this.balance = balance;
    }
    // getters & setters
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getPhone() { return phone; }
    public void setPhone(String phone) { this.phone = phone; }
    public String getUsername() { return username; }
    public void setUsername(String username) { this.username = username; }
    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }
    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }
    public long getBalance() { return balance; }
    public void setBalance(long balance) { this.balance = balance; }
}
package com.squidbet.model;

public class GameSettings {
    private int maxPlayers = 20;
    private long entryFee = 500;
    private int levels = 6;
    private double adminCut = 0.20; // 20%

    public GameSettings() {}
    // getters/setters
    public int getMaxPlayers() { return maxPlayers; }
    public void setMaxPlayers(int maxPlayers) { this.maxPlayers = maxPlayers; }
    public long getEntryFee() { return entryFee; }
    public void setEntryFee(long entryFee) { this.entryFee = entryFee; }
    public int getLevels() { return levels; }
    public void setLevels(int levels) { this.levels = levels; }
    public double getAdminCut() { return adminCut; }
    public void setAdminCut(double adminCut) { this.adminCut = adminCut; }
}
package com.squidbet.storage;

import com.squidbet.model.User;
import com.squidbet.model.GameSettings;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.atomic.AtomicLong;
import java.util.Map;

public class MemoryStore {
    public static final Map<Long, User> users = new ConcurrentHashMap<>();
    public static final GameSettings settings = new GameSettings();
    private static final AtomicLong userIdSeq = new AtomicLong(1);

    static {
        // default admin user (password: 12345678) and sample user
        User admin = new User(userIdSeq.getAndIncrement(), null, "admin", "12345678", "ADMIN", 100000);
        User sample = new User(userIdSeq.getAndIncrement(), "0788000000", "10000001", "87654321", "USER", 1000);
        users.put(admin.getId(), admin);
        users.put(sample.getId(), sample);
    }

    public static Long nextUserId() { return userIdSeq.getAndIncrement(); }
}
package com.squidbet.controller;

import com.squidbet.model.User;
import com.squidbet.storage.MemoryStore;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequestMapping("/api/auth")
@CrossOrigin
public class AuthController {

    @PostMapping("/register")
    public ResponseEntity<?> register(@RequestBody Map<String,String> body) {
        String phone = body.get("phone");
        String username = body.get("username");
        String password = body.get("password");
        if(phone == null || password == null) return ResponseEntity.badRequest().body(Map.of("error","missing"));
        Long id = MemoryStore.nextUserId();
        User u = new User(id, phone, username, password, "USER", 0);
        MemoryStore.users.put(id, u);
        return ResponseEntity.ok(Map.of("ok",true, "userId", id));
    }

    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody Map<String,String> body) {
        String phone = body.get("phone");
        String password = body.get("password");
        for(User u : MemoryStore.users.values()) {
            if(u.getPhone() != null && u.getPhone().equals(phone) && u.getPassword().equals(password)) {
                return ResponseEntity.ok(Map.of("ok", true, "userId", u.getId(), "username", u.getUsername(), "balance", u.getBalance(), "role", u.getRole()));
            }
        }
        // allow admin login by username
        for(User u : MemoryStore.users.values()) {
            if(u.getUsername() != null && u.getUsername().equals(phone) && u.getPassword().equals(password)) {
                return ResponseEntity.ok(Map.of("ok", true, "userId", u.getId(), "username", u.getUsername(), "balance", u.getBalance(), "role", u.getRole()));
            }
        }
        return ResponseEntity.status(401).body(Map.of("error","invalid credentials"));
    }
}
package com.squidbet.controller;

import com.squidbet.model.GameSettings;
import com.squidbet.model.User;
import com.squidbet.storage.MemoryStore;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequestMapping("/api/game")
@CrossOrigin
public class GameController {

    @GetMapping("/settings")
    public GameSettings settings() {
        return MemoryStore.settings;
    }

    @PostMapping("/updateSettings")
    public ResponseEntity<?> updateSettings(@RequestBody GameSettings newSettings) {
        // In real app: auth check admin. Here we accept for demo.
        MemoryStore.settings.setEntryFee(newSettings.getEntryFee());
        MemoryStore.settings.setMaxPlayers(newSettings.getMaxPlayers());
        MemoryStore.settings.setLevels(newSettings.getLevels());
        MemoryStore.settings.setAdminCut(newSettings.getAdminCut());
        return ResponseEntity.ok(Map.of("ok", true));
    }

    @GetMapping("/user/{id}")
    public ResponseEntity<?> getUser(@PathVariable Long id) {
        User u = MemoryStore.users.get(id);
        if(u == null) return ResponseEntity.notFound().build();
        return ResponseEntity.ok(u);
    }

    @PostMapping("/depositSim")
    public ResponseEntity<?> depositSim(@RequestBody Map<String,Object> body) {
        Long id = Long.valueOf(String.valueOf(body.get("userId")));
        long amount = Long.parseLong(String.valueOf(body.get("amount")));
        User u = MemoryStore.users.get(id);
        if(u == null) return ResponseEntity.badRequest().body(Map.of("error","no user"));
        u.setBalance(u.getBalance() + amount);
        return ResponseEntity.ok(Map.of("ok",true, "balance", u.getBalance()));
    }
}
package com.squidbet.controller;

import org.apache.commons.fileupload.FileItemStream;
import org.apache.commons.fileupload.servlet.ServletFileUpload;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import jakarta.servlet.http.HttpServletRequest;

import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.util.Map;

@RestController
@RequestMapping("/api/assets")
@CrossOrigin
public class AssetController {

    @PostMapping("/uploadLogo")
    public ResponseEntity<?> uploadLogo(HttpServletRequest request) {
        try {
            boolean isMultipart = ServletFileUpload.isMultipartContent(request);
            if(!isMultipart) return ResponseEntity.badRequest().body(Map.of("error","not multipart"));
            ServletFileUpload upload = new ServletFileUpload();
            var it = upload.getItemIterator(request);
            while(it.hasNext()) {
                FileItemStream item = it.next();
                if(!item.isFormField()) {
                    String name = item.getName();
                    File dir = new File("uploads");
                    if(!dir.exists()) dir.mkdirs();
                    File f = new File(dir, "site_logo_" + System.currentTimeMillis() + "_" + name);
                    try (InputStream in = item.openStream(); FileOutputStream out = new FileOutputStream(f)) {
                        byte[] buf = new byte[4096];
                        int len;
                        while((len = in.read(buf)) > 0) out.write(buf, 0, len);
                    }
                    return ResponseEntity.ok(Map.of("ok", true, "url", "/uploads/" + f.getName()));
                }
            }
            return ResponseEntity.badRequest().body(Map.of("error","no file"));
        } catch(Exception ex) {
            ex.printStackTrace();
            return ResponseEntity.status(500).body(Map.of("error","upload failed"));
        }
    }
}
server.port=8080
spring.mvc.pathmatch.matching-strategy=ant_path_matcher
FROM node:18-alpine
WORKDIR /app
COPY package.json package-lock.json* ./
RUN npm install --production
COPY . .
EXPOSE 3000
CMD ["node","src/server.js"]
{
  "name": "squid-realtime",
  "version": "1.0.0",
  "main": "src/server.js",
  "scripts": {
    "start": "node src/server.js"
  },
  "dependencies": {
    "axios": "^1.4.0",
    "socket.io": "^4.7.2",
    "express": "^4.18.2"
  }
}
const express = require('express');
const http = require('http');
const { Server } = require('socket.io');
const GameRoom = require('./gameRoom');
const axios = require('axios');

const app = express();
const server = http.createServer(app);
const io = new Server(server, { cors: { origin: "*" } });

const roomsByBet = {}; // key = betAmount, value = array of rooms (last may be waiting)

function getOrCreateWaitingRoom(bet) {
  if(!roomsByBet[bet]) roomsByBet[bet] = [];
  let last = roomsByBet[bet][roomsByBet[bet].length - 1];
  if(!last || last.isFull()) {
    const r = new GameRoom(bet, 20, io);
    roomsByBet[bet].push(r);
    return r;
  }
  return last;
}

io.on('connection', (socket) => {
  console.log('socket connected', socket.id);

  socket.on('joinQueue', async (data) => {
    // data: { userId, username, betAmount }
    const { userId, username, betAmount } = data;
    // simple check with backend to ensure user has no active game
    try {
      const res = await axios.get(`http://backend:8080/api/game/user/${userId}`);
      if(res.status !== 200) {
        socket.emit('joinError', { message: 'User not found' });
        return;
      }
    } catch(e) {
      // ignore in demo
    }

    const room = getOrCreateWaitingRoom(betAmount);
    room.addPlayer({ userId, username, socketId: socket.id });
    socket.join(room.id);
    socket.emit('queued', { roomId: room.id, playersNeeded: room.playersNeeded() });
  });

  socket.on('disconnect', () => {
    console.log('disconnect', socket.id);
  });
});

server.listen(3000, () => console.log('Realtime server running on 3000'));
const { v4: uuidv4 } = require('uuid');

class GameRoom {
  constructor(betAmount, maxPlayers, io) {
    this.id = 'room-' + uuidv4();
    this.betAmount = betAmount;
    this.maxPlayers = maxPlayers;
    this.io = io;
    this.players = [];
    this.started = false;
  }

  addPlayer(p) {
    if(this.players.length >= this.maxPlayers) return false;
    this.players.push({ ...p, status: 'ACTIVE' });
    this.io.to(this.id).emit('roomUpdate', { players: this.players.length, max: this.maxPlayers });
    if(this.players.length === this.maxPlayers) this.startGame();
    return true;
  }

  isFull() {
    return this.players.length >= this.maxPlayers;
  }

  playersNeeded() {
    return this.maxPlayers - this.players.length;
  }

  startGame() {
    if(this.started) return;
    this.started = true;
    console.log('Starting game', this.id);
    // broadcast start
    this.io.to(this.id).emit('gameStart', { roomId: this.id, players: this.players.map(p=>p.username), bet: this.betAmount });
    // begin level progression simulation
    this.runLevels();
  }

  async runLevels() {
    // simulate 6 levels; each level eliminate 2 players until 1 left
    let remaining = [...this.players];
    for(let level = 1; level <= 6; level++) {
      // delay to simulate play
      await new Promise(r => setTimeout(r, 5000)); // 5s per level for demo
      // determine number to eliminate (default 2, final may eliminate more)
      let eliminate = level < 6 ? 2 : remaining.length - 1;
      if(eliminate < 0) eliminate = 0;
      // pick random eliminated players
      const eliminated = [];
      for(let i=0;i<eliminate;i++) {
        const idx = Math.floor(Math.random()*remaining.length);
        eliminated.push(remaining.splice(idx,1)[0]);
      }
      // update statuses
      eliminated.forEach(e => {
        this.io.to(this.id).emit('playerEliminated', { username: e.username, level });
      });
      this.io.to(this.id).emit('levelEnd', { level, remaining: remaining.map(p=>p.username) });
      if(remaining.length === 1) break;
    }
    // declare winner
    const winner = remaining[0];
    this.io.to(this.id).emit('gameEnd', { winner: winner.username, roomId: this.id, bet: this.betAmount});
    // optionally distribute prize server-side (not implemented: demo only)
  }
}

module.exports = GameRoom;
FROM nginx:stable-alpine
COPY . /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Squid Bet — Demo</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header class="site-header">
    <div class="logo"><img id="siteLogo" src="img/default-logo.svg" alt="Squid Bet"/></div>
    <div class="nav">
      <a href="game.html">Play</a> |
      <a href="admin.html">Admin</a>
    </div>
  </header>

  <main class="container">
    <h1>Welcome to Squid Bet (Simulation)</h1>
    <section class="login">
      <h2>Login</h2>
      <input id="phone" placeholder="phone or username"><br>
      <input id="password" placeholder="password" type="password"><br>
      <button id="loginBtn">Login</button>
      <p>Demo admin: username=admin password=12345678</p>
    </section>
  </main>

  <script>
    document.getElementById('loginBtn').onclick = async () => {
      const phone = document.getElementById('phone').value;
      const password = document.getElementById('password').value;
      const res = await fetch('http://localhost:8080/api/auth/login', {
        method:'POST', headers:{'content-type':'application/json'},
        body: JSON.stringify({phone, password})
      });
      const data = await res.json();
      if(data.ok) {
        localStorage.setItem('user', JSON.stringify(data));
        alert('Logged in: ' + data.username);
        location.href = 'game.html';
      } else {
        alert('Login failed');
      }
    };
  </script>
</body>
</html>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Squid Bet — Game Room (Demo)</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
</head>
<body>
  <header><a href="index.html">Home</a> | <span id="userInfo"></span></header>
  <main>
    <h2>Game Room Demo (Three.js placeholder)</h2>
    <div id="scene" style="width:800px;height:400px;border:1px solid #333"></div>
    <div>
      <label>Bet amount (FRW):</label>
      <select id="bet">
        <option value="200">200</option>
        <option value="1000">1000</option>
        <option value="5000">5000</option>
      </select>
      <button id="joinBtn">Join Queue</button>
      <div id="status"></div>
    </div>
    <div id="log"></div>
  </main>

  <script>
    const user = JSON.parse(localStorage.getItem('user') || 'null');
    if(!user) { alert('Please login first'); location.href='index.html'; }
    document.getElementById('userInfo').innerText = user.username + ' (balance: ' + user.balance + ')';

    const socket = io('http://localhost:3000');

    socket.on('connect', ()=> {
      appendLog('Connected to realtime server');
    });

    socket.on('queued', data => {
      appendLog('Queued: roomId=' + data.roomId + ' playersNeeded=' + data.playersNeeded);
      document.getElementById('status').innerText = 'Queued (players needed: ' + data.playersNeeded + ')';
    });

    socket.on('roomUpdate', data => {
      appendLog('Room update: ' + data.players + '/' + data.max);
    });

    socket.on('gameStart', data => appendLog('Game starting: ' + JSON.stringify(data)));
    socket.on('playerEliminated', data => appendLog('Eliminated: ' + data.username + ' at level ' + data.level));
    socket.on('levelEnd', data => appendLog('Level ' + data.level + ' ended; remaining: ' + data.remaining.join(', ')));
    socket.on('gameEnd', data => appendLog('Game ended! Winner: ' + data.winner));

    document.getElementById('joinBtn').onclick = () => {
      const bet = Number(document.getElementById('bet').value);
      socket.emit('joinQueue', { userId: user.userId || user.userId, username: user.username, betAmount: bet });
      appendLog('Requested to join queue with bet ' + bet);
    };

    function appendLog(t) {
      const div = document.getElementById('log');
      const p = document.createElement('div');
      p.innerText = new Date().toLocaleTimeString() + ' — ' + t;
      div.prepend(p);
    }

    // minimal Three.js placeholder
    const sceneDiv = document.getElementById('scene');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, 800/400, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(800,400);
    sceneDiv.appendChild(renderer.domElement);
    const geometry = new THREE.BoxGeometry();
    const material = new THREE.MeshNormalMaterial();
    const cube = new THREE.Mesh(geometry, material);
    scene.add(cube);
    camera.position.z = 5;
    function animate() {
      requestAnimationFrame(animate);
      cube.rotation.x += 0.01;
      cube.rotation.y += 0.01;
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin — Squid Bet Demo</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <h1>Admin Panel (Demo)</h1>
  <section>
    <h3>Upload Logo (admin only)</h3>
    <form id="logoForm" enctype="multipart/form-data">
      <input type="file" id="logoFile" accept=".png,.svg,.webp"/>
      <button type="submit">Upload Logo</button>
    </form>
    <div id="logoMsg"></div>
  </section>

  <section>
    <h3>Game Settings</h3>
    <label>Entry Fee: <input id="entryFee" value="500"></label><br>
    <label>Max Players: <input id="maxPlayers" value="20"></label><br>
    <label>Levels: <input id="levels" value="6"></label><br>
    <button id="saveSettings">Save</button>
    <div id="settingsMsg"></div>
  </section>

  <script>
    document.getElementById('logoForm').onsubmit = async (e) => {
      e.preventDefault();
      const f = document.getElementById('logoFile').files[0];
      if(!f) return alert('choose file');
      const fd = new FormData(); fd.append('file', f);
      // direct upload to backend
      const res = await fetch('http://localhost:8080/api/assets/uploadLogo', { method:'POST', body: fd });
      const data = await res.json();
      document.getElementById('logoMsg').innerText = JSON.stringify(data);
    };

    document.getElementById('saveSettings').onclick = async () => {
      const body = { entryFee: Number(document.getElementById('entryFee').value), maxPlayers: Number(document.getElementById('maxPlayers').value), levels: Number(document.getElementById('levels').value), adminCut: 0.2 };
      const res = await fetch('http://localhost:8080/api/game/updateSettings', { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(body) });
      const data = await res.json();
      document.getElementById('settingsMsg').innerText = JSON.stringify(data);
    };
  </script>
</body>
</html>
body { font-family: Inter, Arial; background: #0b0b0f; color: #eee; margin:0; padding:20px; }
.site-header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background: linear-gradient(90deg,#05030a,#0f0920); box-shadow:0 4px 20px rgba(0,0,0,0.6); }
.logo img { height:48px; filter: drop-shadow(0 0 10px rgba(180,120,255,0.9)); }
.container { max-width:900px; margin:30px auto; }
button { background: linear-gradient(90deg,#7c3aed,#4c1d95); color:white; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; }
input, select { padding:8px; margin:6px 0; border-radius:6px; border:1px solid #333; background:#111; color:#eee; }
.profile-icon { width:64px; height:64px; border-radius:50%; overflow:hidden; box-shadow: 0 0 12px rgba(150, 80, 255, 0.9); }
cd squid-bet
git init
git add .
git commit -m "Squid Bet simulation starter"
# create GitHub repo then:
git remote add origin https://github.com/yourname/squid-bet.git
git push -u origin main
